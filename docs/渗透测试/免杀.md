# 免杀

https://github.com/TideSec/BypassAntiVirus

要求：

- 钓鱼木马：

	- 功能正常，伪装要好:

    - 能正常弹出你原本想让客户看到的东西，保证能正常上线，兼容大部分环境
    - 伪装：长文件名，修改exe显示的目标等

  - 短期免杀：
- 钓鱼马很容易被分析，最好是能够快速生成，保证每次文件md5与加密key都会改变，shellcode不建议远程加载。
- 维持马：
    - 长久免杀：
    - 体积小：可以使用分离免杀去减小木马体积，也可以通过劫持软件DLL。
    - 注意隐藏

免杀技巧

- 特征码：
- 去除特征：
    - 修改文件md5：
    - 修改敏感函数：
- 加壳免杀：
    - 压缩壳，加密壳，
    - vmprotect
- 编码加密：
    - XOR：
    - AES
- 本地分离：
    - 将 shellcode与加加载器进行分离。 shellcode通过加密放置于文件中，加载器首先判断文件是指定的目录文件是否存在，如果不存在，则不做任何操作，直接退出。如果目标文件存在，则读取指定文件内容，再通过内置的ke去对文件内容进行解密，解密成功则加载 shellcode进内存，正常反弹she』l解密失败的话直接退出
- 远程分离：
    - 将 shellcode与加加载器进行分离。 shellcode通过加密放置于文件中，加载器首先判断文件是指定的目录文件是否存在，如果不存在，则不做任何操作，直接退出。如果目标文件存在，则读取指定文件内容，再通过内置的ke去对文件内容进行解密，解密成功则加载 shellcode进内存，正常反弹she』l解密失败的话直接退出

免杀工具：

- 掩日
- DarkGlD
- Foureye

杀软分析：

- ![image-20220905162259617](免杀.assets/image-20220905162259617.png)

常见问题：

- 分离免杀要考虑的向题？
    - 1.用尽可能可信的域名。例如在某些知名网站上上传含有 shellcode的图片。
    - 2.要考虑域名不解析的情况。曾遇到过因为目标机器无DNS导致域名无法解析，无法获取远程 shellcode的问题
    - 3.要考虑到P被封的情况，所以可以考虑木马使用DN方案。